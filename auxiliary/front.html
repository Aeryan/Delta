<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Deltabot</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
<div style="height: 50px"></div>
<div>
    <div class="row">
        <div class="column" style="position: fixed">
            <div style="width: 400px">
                Welcome to Deltabot's testing environment. All conversations will be logged to help improve the chatbot.<br><br>Whenever you break the chatbot, feel free to refresh the page and attempt to break it again in a different way!
            </div>
        </div>
        <div class="column">
            <div style="width:20%; margin:0 auto; padding: 5px; border: 1px solid black;">
                <div id="textdiv"></div>
                <form name="myForm" id="my_form" onsubmit="return postMsg(false)" method="post">
                    <label>Input:
                        <input type="text" name="fname" id="textinput">
                    </label>
                    <input type="submit" id="submit_btn" value="Submit">
                </form>
            </div>
        </div>
    </div>
</div>
<script>
    const id = Date.now();
    console.log(id)

    function postMsg(initial) {
        var msg;
        if (initial === false) {
            msg = document.forms["myForm"]["fname"].value;
            var node = document.createElement("P")
            node.appendChild(document.createTextNode(msg))
            document.getElementById("textdiv").appendChild(node)
            document.getElementById("my_form").reset()
        }
        else {
            msg = "initmsg";
        }

        var xhr = new XMLHttpRequest();
        xhr.open("POST", "/webhook", false);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                var json = JSON.parse(xhr.responseText);
                console.log(json)
                for (i = 0; i < json.length; i++) {
                    var response_node = document.createElement("P")
                    response_node.appendChild(document.createTextNode(json[i]['text']))
                    response_node.style = "text-align: right"
                    document.getElementById("textdiv").appendChild(response_node)
                    document.getElementById("submit_btn").scrollIntoView()
                }
            }
        };
        var data = JSON.stringify({"sender": id, "message": msg});
        xhr.send(data);
        document.getElementById("submit_btn").scrollIntoView()
        return false;
    }

    postMsg(true);
    
</script>
</body>
</html>